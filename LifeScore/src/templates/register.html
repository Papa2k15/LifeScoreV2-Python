<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Registration</title>
<link rel="stylesheet" href="../static/bootstrap/css/bootstrap.min.css">
<link rel="stylesheet"
	href="https://fonts.googleapis.com/css?family=Montserrat">
<link rel="stylesheet" href="../static/css/theme.css">
</head>

<body>
	<nav class="navbar navbar-default custom-header">
		<div class="container-fluid">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed"
					data-toggle="collapse" data-target="#navbar-collapse">
					<span class="sr-only">Toggle navigation</span> <span
						class="icon-bar"></span> <span class="icon-bar"></span> <span
						class="icon-bar"></span>
				</button>
				<a class="navbar-brand navbar-link" href="#">LifeScore </a>
			</div>
			<div class="collapse navbar-collapse" id="navbar-collapse">
				<ul class="nav navbar-nav navbar-right">
					<li role="presentation"><a href="#">Already have an
							account?</a></li>
					<li class="active" role="presentation"><a href="/">Login </a></li>
				</ul>
			</div>
		</div>
	</nav>
	<script type="text/javascript">
		var emailReady = false;
		var userNameReady = false;
		var passwordReady = false;
	</script>
	<div class="row life-form">
		<div class="col-md-8 col-md-offset-2">
			<h1 class="text-center">Registration</h1>
		</div>
		<div class="col-md-9 col-md-offset-2">
			<form id="registerForm" action="/register_user/" method="post">
				<div class="form-group">
					<div class="row">
						<div class="col-md-3">
							<label class="control-label">Name: </label>
						</div>
						<div class="col-md-4">
							<input class="form-control" type="text" name="first_name"
								required="" placeholder="First" autocomplete="off">
						</div>
						<div class="col-md-4">
							<input class="form-control" type="text" name="last_name"
								required="" placeholder="Last" autocomplete="off">
						</div>
					</div>
				</div>

				<script type="text/javascript">					

					 function emailSearch(str) {
				   	  if (str.length==0) {
				   		    document.getElementById("emailcheck").innerHTML="";
					   		$("input[type='email']#email").css("border","1px solid #ccc");
						    $('#emailcheck').hide();
						    emailReady = false;
				   		    return;
				   		  }
				   		  if (window.XMLHttpRequest) {
				   		    xmlhttp=new XMLHttpRequest();
				   		  } else {  
				   		    xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
				   		  }
				   		  xmlhttp.onreadystatechange=function() {
				   		    if (xmlhttp.readyState==4 && xmlhttp.status==200) {
				   		    	if (xmlhttp.responseText.length > 0){
					   		      $('#emailcheck').show();
					   		      $("input[type='email']#email").css("border","1px solid red");
					   		      	document.getElementById("emailcheck").innerHTML=xmlhttp.responseText;
					   		    	 emailReady = false;
				   		    	} else {
						   		  $("input[type='email']#email").css("border","1px solid #ccc");
				  	   		      $('#emailcheck').hide();
				  	   		 		emailReady = true;
				   		    	}
				   		    }
				   		  }
				   		  xmlhttp.open("GET","/check_email?q="+str,true);
				   		  xmlhttp.send();
				   		}
				</script>

				<div class="form-group">
					<div class="row">
						<div class="col-md-3">
							<label class="control-label" for="email">Email: </label>
						</div>
						<div class="col-md-8">
							<input class="form-control" type="email" id="email" name="email"
								required="" onblur="emailSearch(this.value);"
								onkeydown="emailSearch(this.value);" autocomplete="off">
							<div id="emailcheck"></div>
						</div>
					</div>
				</div>

				<script type="text/javascript">
					
					 function usernameSearch(str) {
				   	  if (str.length==0) {
				   		    document.getElementById("usernamecheck").innerHTML="";
					   		$("input[type='text']#username").css("border","1px solid #ccc");
						    $('#usernamecheck').hide();
						    userNameReady = false;
				   		    return;
				   		  }
				   		  if (window.XMLHttpRequest) {
				   		    xmlhttp=new XMLHttpRequest();
				   		  } else {  
				   		    xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
				   		  }
				   		  xmlhttp.onreadystatechange=function() {
				   		    if (xmlhttp.readyState==4 && xmlhttp.status==200) {
				   		    	if (xmlhttp.responseText.length > 0){
					   		      $('#usernamecheck').show();
					   		      $("input[type='text']#username").css("border","1px solid red");
					   		      	document.getElementById("usernamecheck").innerHTML=xmlhttp.responseText;
					   		     userNameReady = false;
				   		    	} else {
						   		  $("input[type='text']#username").css("border","1px solid #ccc");
				  	   		      $('#usernamecheck').hide();
				  	   		 		userNameReady = true;
				   		    	}
				   		    }
				   		  }
				   		  xmlhttp.open("GET","/check_username?q="+str,true);
				   		  xmlhttp.send();
				   		}
					 
				</script>

				<div class="form-group">
					<div class="row">
						<div class="col-md-3">
							<label class="control-label" for="username">Username: </label>
						</div>
						<div class="col-md-8">
							<input class="form-control" type="text" name="username"
								id="username" required="" autocomplete="on"
								onblur="usernameSearch(this.value);"
								onkeydown="usernameSearch(this.value);">
							<div id="usernamecheck"></div>
						</div>
					</div>
				</div>

				<div class="form-group">
					<div class="row">
						<div class="col-md-3">
							<label class="control-label" for="password">Password: </label>
						</div>
						<div class="col-md-4">
							<input class="form-control" type="password" name="password"
								id="password" required="" placeholder="Password"
								autocomplete="off">
						</div>
						<div class="col-md-4">
							<input class="form-control" type="password" id="confirm_password"
								name="confirm_password" required="" placeholder="Confirm"
								autocomplete="off">
						</div>
					</div>
					<div id="password_error" class="alert-danger" hidden="hidden">Passwords don't match</div>
				</div>
				<div class="form-group">
					<div class="row">
						<div class="col-md-9 col-md-offset-1">
							<button class="btn btn-default form-control" type="submit">Register
							</button>
						</div>
					</div>
				</div>
			</form>
		</div>
	</div>
	<script src="../static/js/jquery.min.js"></script>
	<script src="../static/bootstrap/js/bootstrap.min.js"></script>
	<script>
		$( document ).ready(function() {
			
		 $("input[type='password']#confirm_password").focusout(function(){
		        var pass = $("input[type='password']#password").val();
		        var pass2 = $("input[type='password']#confirm_password").val();
		        if(pass != pass2){
		   		  $("input[type='password']#password").css("border","1px solid red");
		   		  $("input[type='password']#confirm_password").css("border","1px solid red");
		   		  $("div#password_error").show();
		   			passwordReady = false;
		        } else {
		          $("input[type='password']#password").css("border","1px solid #ccc");
			   	  $("input[type='password']#confirm_password").css("border","1px solid #ccc");	
		   		  $("div#password_error").hide();
		   			passwordReady = true;
		        }
		    });
		 		 
		 
		 $( "form#registerForm" ).submit(function( event ) {			  
			  if(!userNameReady || !emailReady || !passwordReady){
				  event.preventDefault();
			  }
			});
		});
	</script>
</body>

</html>